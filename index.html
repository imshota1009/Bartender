<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éê„Éº„ÉÜ„É≥„ÉÄ„Éº„Ç≤„Éº„É†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700&family=M+PLUS+Rounded+1c:wght@700&family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111;
            background-image: radial-gradient(circle at center, #333 0%, #111 70%);
            overflow: hidden;
        }
        .font-title { font-family: 'Playfair Display', serif; }
        .font-jp { font-family: 'M PLUS Rounded 1c', sans-serif; }
        .font-dot { font-family: 'DotGothic16', sans-serif; }
        
        .game-view {
            width: 100%;
            max-width: 800px;
            height: 95vh;
            max-height: 900px;
            background: #262626;
            box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.5);
            border: 4px solid #4a5568;
        }

        #bar-counter {
            background-color: #6d4c41;
            background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.05) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.05) 75%, transparent 75%, transparent);
            background-size: 30px 30px;
            border-top: 5px solid #8d6e63;
        }

        .ingredient-bottle {
            transition: all 0.2s ease-in-out; cursor: pointer; position: relative;
            height: 120px; border-radius: 10px 10px 0 0;
            display: flex; align-items: flex-end; justify-content: center; padding-bottom: 8px;
            color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            box-shadow: inset 0 -20px 30px -10px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.2);
            font-size: 0.8rem; text-align: center;
        }
        .ingredient-bottle:hover { transform: scale(1.05) translateY(-5px); filter: brightness(1.2); }
        .ingredient-bottle.selected { transform: scale(1.1) translateY(-10px); filter: brightness(1.5); box-shadow: 0 0 15px 5px var(--glow-color, #fff); }

        .shake-animation { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg); } 20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); } 40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); }
        }
        
        #customer { transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out; }
        #customer.slide-in { transform: translateX(0) scale(1); opacity: 1; } #customer.slide-out { transform: translateX(100px) scale(0.8); opacity: 0; }
        
        #customer-dialogue {
            position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            background-color: white; color: #333; padding: 8px 16px; border-radius: 12px;
            max-width: 250px; text-align: center; opacity: 0;
            transition: opacity 0.3s, transform 0.3s; pointer-events: none; z-index: 10;
        }
        #customer-dialogue.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
        #customer-dialogue::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border-width: 10px; border-style: solid; border-color: white transparent transparent transparent; }
        
        #game-overlay { background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); }
        
        .timer-danger { animation: pulse-danger 1s infinite; }
        @keyframes pulse-danger { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 50% { transform: scale(1.1); box-shadow: 0 0 10px 10px rgba(220, 38, 38, 0); } }

        .floating-text { position: absolute; font-size: 1.5rem; font-weight: bold; animation: float-up 1.5s ease-out forwards; pointer-events: none; z-index: 20; }
        @keyframes float-up { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-50px); opacity: 0; } }

        @keyframes fill-glass { from { height: 0%; } to { height: var(--fill-height, 80%); } }
        .animate-fill { animation: fill-glass 0.5s ease-out forwards; }
        
        .button-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 10px 15px rgba(59, 130, 246, 0); } }

        /* Room specific styles */
        #room-container {
            background: #3a3a3a url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            background-color: #3a312c;
        }
        .interactive-object {
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .interactive-object:hover {
            transform: translateY(-5px);
            background-color: rgba(0,0,0,0.4);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3), 0 4px 6px -2px rgba(0,0,0,0.2);
            border-color: rgba(255,255,255,0.4);
        }
        .object-icon { font-size: 3rem; line-height: 1; }
        .object-label { font-weight: bold; margin-top: 0.5rem; }

        #modal-container { background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); }
        #modal-content { animation: modal-fade-in 0.3s ease-out forwards; }
        @keyframes modal-fade-in { from { opacity: 0; transform: translate(-50%, -55%); } to { opacity: 1; transform: translate(-50%, -50%); } }
        
        .news-horror { color: #ef4444; animation: text-flicker 3s linear infinite; }
        @keyframes text-flicker { 0%, 19.9%, 22%, 62.9%, 64%, 64.9%, 70%, 100% { opacity: 0.99; text-shadow: -1px -1px 0 #a22, 1px -1px 0 #a22, -1px 1px 0 #a22, 1px 1px 0 #a22, 0 0 5px #f44, 0 0 10px #f44, 0 0 20px #f44, 0 0 30px #f44, 0 0 40px #f44; } 20%, 21.9%, 63%, 63.9%, 65%, 69.9% { opacity: 0.4; text-shadow: none; } }
        .upgrade-button:disabled { background-color: #4b5563; cursor: not-allowed; opacity: 0.6; }

    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen">
    <audio id="bgm-audio" loop></audio>

    <!-- Game View -->
    <div id="game-container" class="game-view mx-auto rounded-2xl p-4 md:p-6 flex-col relative overflow-hidden hidden">
        <!-- Game Header, Main, Footer ... (Content is the same as previous version) -->
    </div>
    
    <!-- Room View -->
    <div id="room-container" class="game-view mx-auto rounded-2xl p-6 md:p-8 flex flex-col relative overflow-hidden hidden">
        <header class="flex justify-between items-center pb-4 border-b-2 border-white/10 mb-4">
             <div>
                <h1 class="font-title text-4xl">My Room</h1>
                <p class="font-jp">Day <span id="room-day-display">1</span> - ÈñâÂ∫óÂæå</p>
             </div>
             <div class="text-right">
                <p class="font-jp text-lg">ÊâÄÊåÅÈáë</p>
                <p class="font-bold text-3xl">¬•<span id="room-money-display">0</span></p>
             </div>
        </header>

        <main class="flex-grow grid grid-cols-3 grid-rows-2 gap-4">
            <div id="bed-object" class="interactive-object flex flex-col justify-center items-center col-span-2">
                <div class="object-icon">üõèÔ∏è</div>
                <div class="object-label font-jp">„Éô„ÉÉ„Éâ</div>
                <p class="text-sm text-gray-400 font-jp">ÂØù„Å¶Ê¨°„ÅÆÊó•„Å´ÈÄ≤„ÇÄ</p>
            </div>
            <div id="tv-object" class="interactive-object flex flex-col justify-center items-center">
                <div class="object-icon">üì∫</div>
                <div class="object-label font-jp">„ÉÜ„É¨„Éì</div>
                <p class="text-sm text-gray-400 font-jp">„Éã„É•„Éº„Çπ„ÇíË¶ã„Çã</p>
            </div>
            <div id="laundry-object" class="interactive-object flex flex-col justify-center items-center">
                <div class="object-icon">üß∫</div>
                <div class="object-label font-jp">Ê¥óÊøØÊ©ü</div>
                 <p class="text-sm text-gray-400 font-jp">Ê¥óÊøØ„Çí„Åô„Çã</p>
            </div>
            <div id="game-console-object" class="interactive-object flex flex-col justify-center items-center">
                <div class="object-icon">üéÆ</div>
                <div class="object-label font-jp">„Ç≤„Éº„É†Ê©ü</div>
                 <p class="text-sm text-gray-400 font-jp">Ê∞óÂàÜËª¢Êèõ</p>
            </div>
            <div id="desk-object" class="interactive-object flex flex-col justify-center items-center">
                <div class="object-icon">üñ•Ô∏è</div>
                <div class="object-label font-jp">„Éá„Çπ„ÇØ</div>
                <p class="text-sm text-gray-400 font-jp">„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ</p>
            </div>
        </main>
        <footer class="text-center pt-4 text-gray-400 font-jp">
            ÈÉ®Â±ã„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Êìç‰Ωú„Åó„Åæ„Åô„ÄÇ
        </footer>
    </div>

    <!-- Initial Start Screen -->
    <div id="game-overlay" class="absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-500 z-30">
        <h1 class="font-title text-6xl md:text-8xl mb-4">Bartender</h1>
        <button id="start-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-2xl shadow-lg transition-transform transform font-jp button-pulse">„Ç≤„Éº„É†ÈñãÂßã</button>
    </div>

    <!-- Modal for News, Games, Upgrades -->
    <div id="modal-container" class="absolute inset-0 z-40 items-center justify-center hidden">
        <div id="modal-content" class="bg-gray-800 border-4 border-gray-600 rounded-xl shadow-2xl p-8 w-11/12 max-w-2xl relative">
            <h2 id="modal-title" class="text-3xl font-bold font-jp mb-6 text-center"></h2>
            <div id="modal-body" class="text-lg font-jp leading-relaxed"></div>
            <button id="modal-close-button" class="absolute top-4 right-4 text-3xl font-bold text-gray-400 hover:text-white transition-colors">&times;</button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Game Data (including new NEWS data) ---
        const INGREDIENTS = { vodka: { name: '„Ç¶„Ç©„ÉÉ„Ç´', color: '#e0f7fa', glow: '#80deea' }, gin: { name: '„Ç∏„É≥', color: '#e8f5e9', glow: '#a5d6a7' }, rum: { name: '„É©„É†', color: '#ffecb3', glow: '#ffe082' }, cassis: { name: '„Ç´„Ç∑„Çπ', color: '#4a148c', glow: '#ce93d8' }, lime: { name: '„É©„Ç§„É†', color: '#d4e157', glow: '#e6ee9c' }, orangeJuice: { name: '„Ç™„É¨„É≥„Ç∏J', color: '#ff9800', glow: '#ffb74d' }, tonic: { name: '„Éà„Éã„ÉÉ„ÇØ', color: '#cfd8dc', glow: '#eceff1' }, cola: { name: '„Ç≥„Éº„É©', color: '#3e2723', glow: '#a1887f' }, gingerAle: { name: '„Ç∏„É≥„Ç∏„É£„Éº„Ç®„Éº„É´', color: '#fbc02d', glow: '#fff176' }};
        const COCKTAILS = [ { name: '„Çπ„ÇØ„É™„É•„Éº„Éâ„É©„Ç§„Éê„Éº', ingredients: ['vodka', 'orangeJuice'], needsIce: true, garnish: 'orange' }, { name: '„Ç∏„É≥„Éà„Éã„ÉÉ„ÇØ', ingredients: ['gin', 'tonic', 'lime'], needsIce: true, garnish: 'lime' }, { name: '„Ç≠„É•„Éº„Éê„É™„Éñ„É¨', ingredients: ['rum', 'cola', 'lime'], needsIce: true, garnish: 'lime' }, { name: '„É¢„Çπ„Ç≥„Éü„É•„Éº„É´', ingredients: ['vodka', 'gingerAle', 'lime'], needsIce: true, garnish: 'lime' }, { name: '„Ç´„Ç∑„Çπ„Ç™„É¨„É≥„Ç∏', ingredients: ['cassis', 'orangeJuice'], needsIce: true, garnish: 'orange' }, { name: '„É©„É†„Ç≥„Éº„ÇØ', ingredients: ['rum', 'cola'], needsIce: true, garnish: 'lime' }, { name: '„Ç∏„É≥„Éê„ÉÉ„ÇØ', ingredients: ['gin', 'gingerAle', 'lime'], needsIce: true, garnish: 'lime' }];
        const SECRET_COCKTAILS = [{ name: '„ÇÆ„É†„É¨„ÉÉ„Éà', ingredients: ['gin', 'lime'], needsIce: true, bonus: 500 }];
        const CUSTOMERS = [ { name: "„Éê„Éº„ÅÆÂ∏∏ÈÄ£", emoji: 'üßë‚Äçüíº', quotes: { order: ["„ÅÑ„Å§„ÇÇ„ÅÆÈ†º„ÇÄ„Çà", "‰ªäÊó•„ÅØ„Çπ„ÇØ„É™„É•„Éº„Éâ„É©„Ç§„Éê„ÉºÊ∞óÂàÜ„Å†"], success: ["„Åì„Çå„Å†„Çà„ÄÅ„Åì„ÇåÔºÅ", "„ÅÜ„Åæ„ÅÑÔºÅ„Åæ„ÅüÊù•„Çã„Çà"], fail: ["„ÅÜ„Éº„Çì„ÄÅÂë≥„ÅåÈÅï„ÅÜ„Å™‚Ä¶", "„Åì„Çå„ÅØÈ†º„Çì„Åß„Å™„ÅÑ„Åû"] }}, { name: "ÁßëÂ≠¶ËÄÖ", emoji: 'üë©‚Äçüî¨', quotes: { order: ["ÂÆåÁíß„Å™ÊØîÁéá„ÅßÈ†º„ÇÄ", "ÂÆüÈ®ìÊàêÂäü„ÅÆÁ•ù„ÅÑ„Å†"], success: ["Ë®àÁÆóÈÄö„Çä„ÄÅÂÆåÁíß„Å™Âë≥„Å†", "Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ"], fail: ["ÈÖçÂêà„ÇíÈñìÈÅï„Åà„Åü„Å™Ôºü", "„Åì„Çå„ÅØÂ§±Êïó‰Ωú„Å†"] }}, { name: "Ëä∏Ë°ìÂÆ∂", emoji: 'üë®‚Äçüé®', quotes: { order: ["„Ç§„É≥„Çπ„Éî„É¨„Éº„Ç∑„Éß„É≥„ÅåÊ¨≤„Åó„ÅÑ", "Ëä∏Ë°ìÁöÑ„Å™‰∏ÄÊùØ„Çí"], success: ["Ëâ≤ÂΩ©Ë±ä„Åã„Å™Âë≥„Å†ÔºÅ", "ÂÇë‰Ωú„Å†„Å≠ÔºÅ"], fail: ["Âêõ„Å´„ÅØÊâçËÉΩ„Åå„Å™„ÅÑ„Å™", "Ëâ≤„ÅåÊøÅ„Å£„Å¶„ÅÑ„Çã‚Ä¶"] }}];
        const MILLIONAIRE_CUSTOMER = { name: "Â§ßÂØåË±™", emoji: 'ü§ë', quotes: { order: ["ÊúÄÈ´òÁ¥ö„ÅÆ„ÇÇ„ÅÆ„ÇíÈ†º„ÇÄ", "Âêõ„ÅÆËÖï„ÇíË¶ã„Åõ„Å¶„Åø„Çç"], success: ["Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ„ÉÅ„ÉÉ„Éó„Å†„ÄÅ„Å®„Å£„Å¶„Åä„Åç„Åü„Åæ„Åà", "Ê∞ó„Å´ÂÖ•„Å£„Åü„ÄÅ„Åæ„ÅüÊù•„Çà„ÅÜ"], fail: ["„Åå„Å£„Åã„Çä„Å†„ÄÅÊôÇÈñì„ÅØÈáë„Å™„Çä„Å†„Åû", "ÁßÅ„ÅÆËàå„ÅØ„Åî„Åæ„Åã„Åõ„Çì„Çà"] }};
        const DEATH_CUSTOMER = { name: "ÔºüÔºüÔºü", emoji: 'üíÄ', quotes: { order: ["‚Ä¶Âñâ„ÅåÊ∏á„ÅÑ„Å¶„Å™", "‰æã„ÅÆ„ÇÇ„ÅÆ„Çí‚Ä¶È†º„ÇÅ„Çã„ÅãÔºü", "È≠Ç„ÇíÊè∫„Åï„Å∂„Çã‰∏ÄÊùØ„Çí‚Ä¶"], success: ["‚Ä¶ÊÇ™„Åè„Å™„ÅÑ„ÄÇ„Åæ„Åü‰ºö„Åä„ÅÜ", "„Éï„Éï‚Ä¶È≠Ç„ÅåÊΩ§„Å£„Åü„Åû", "‚Ä¶„ÅäÂâç„ÄÅÊ∞ó„Å´ÂÖ•„Å£„Åü"], fail: ["‚Ä¶Ê¨°„ÅØ„Å™„ÅÑ„Å®ÊÄù„Åà", "ÊÑö„Åã„Å™‰∫∫Èñì„ÇÅ‚Ä¶", "„ÅäÂâç„ÅÆÈ≠Ç„ÅØÊøÅ„Å£„Å¶„ÅÑ„Çã„Å™"] }};
        const CRITIC_CUSTOMER = { name: "Ë©ïË´ñÂÆ∂", emoji: 'üßê', quotes: { order: ["Âêõ„ÅÆËÖïÂâç„ÇíË¶ã„Åõ„Å¶„Åè„Çå„Åü„Åæ„Åà", "ÁßÅ„ÇíÈ©ö„Åã„Åõ„Çã‰∏ÄÊùØ„Çí", "‰Ωï„ÅãÂâµ‰Ωú„ÇíÈ†º„ÇÄ"], success: ["„Åµ„ÇÄ‚Ä¶ÊÇ™„Åè„Å™„ÅÑÁµÑ„ÅøÂêà„Çè„Åõ„Å†", "Áã¨ÂâµÁöÑ„Åß„Çà„Çç„Åó„ÅÑ"], fail: ["Âá°Â∫∏„Å™Âë≥„Å†", "„Åì„Çå„Åß„ÅØË©ï‰æ°„Å´ÂÄ§„Åó„Å™„ÅÑ"] }};
        const GARNISHES = { lime: 'üçã', orange: 'üçä', cherry: 'üçí' };
        const GOOD_COMBOS = [ ['gin', 'lime'], ['rum', 'cola'], ['vodka', 'orangeJuice'], ['cassis', 'orangeJuice'] ];
        const UPGRADES = {
            shaker: { name: 'È´òÂìÅË≥™„Ç∑„Çß„Ç§„Ç´„Éº', description: '„Ç≥„É≥„Éú„Éú„Éº„Éä„Çπ„Åå1.2ÂÄç„Å´„Å™„Çã', cost: 2000, purchased: false },
            iceMachine: { name: 'È´òÊÄßËÉΩË£ΩÊ∞∑Ê©ü', description: 'Ê∞∑„Çí‰Ωø„ÅÜ„Ç´„ÇØ„ÉÜ„É´„ÅÆË©ï‰æ°„ÅåÂ∞ë„Åó‰∏ä„Åå„Çã', cost: 1500, purchased: false },
            barManual: { name: '„Éê„Éº„ÉÜ„É≥„ÉÄ„ÉºÊïôÊú¨', description: 'Â§±ÊïóÊôÇ„ÅÆ„Éö„Éä„É´„ÉÜ„Ç£„ÅåÂçäÊ∏õ„Åô„Çã', cost: 3000, purchased: false }
        };
        const NEWS_STORIES = [
            { title: "Â§©Ê∞ó‰∫àÂ†±", content: "ÊòéÊó•„ÅØ‰∏ÄÊó•„ÇíÈÄö„Åó„Å¶Êô¥„Çå„Çã„Åß„Åó„Çá„ÅÜ„ÄÇÁµ∂Â•Ω„ÅÆ„ÅäÂá∫„Åã„ÅëÊó•Âíå„Å®„Å™„Çä„Åù„ÅÜ„Åß„Åô„ÄÇ", horror: false },
            { title: "ÁµåÊ∏à„Éã„É•„Éº„Çπ", content: "Â∏ÇÂ†¥„ÅØÂÆâÂÆö„Åó„ÅüÂãï„Åç„ÇíË¶ã„Åõ„Å¶„ÅÑ„Åæ„Åô„ÄÇÂ∞ÇÈñÄÂÆ∂„ÅØ‰ªäÂæå„ÇÇ„Åì„ÅÆÂÇæÂêë„ÅåÁ∂ö„Åè„Å®Ë¶ã„Å¶„ÅÑ„Åæ„Åô„ÄÇ", horror: false },
            { title: "Ë°ó„ÅÆË©±È°å", content: "ÈßÖÂâç„ÅÆÂ∫ÉÂ†¥„ÅßÈÄ±Êú´„Å´„Éï„É™„Éº„Éû„Éº„Ç±„ÉÉ„Éà„ÅåÈñãÂÇ¨„Åï„Çå„ÄÅÂ§ö„Åè„ÅÆ‰∫∫„ÅßË≥ë„Çè„ÅÑ„Åæ„Åó„Åü„ÄÇ", horror: false },
            { title: "‰∏çÂèØËß£„Å™‰∫ã‰ª∂", content: "ËøëÈö£„ÅÆÊ£Æ„Åß„ÄÅ„Åæ„Åü„Åó„Å¶„ÇÇÂéüÂõ†‰∏çÊòé„ÅÆÂ§±Ë∏™‰∫ã‰ª∂„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇÁõÆÊíÉËÄÖ„Å´„Çà„Çã„Å®„ÄÅ<span class='news-horror'>Èúß„ÅÆ‰∏≠„Åã„ÇâÂ•áÂ¶ô„Å™Â£∞„ÅåËÅû„Åì„Åà„Åü</span>„Å®„ÅÆ„Åì„Å®„Åß„Åô„ÄÇË≠¶ÂØü„ÅØ‰ΩèÊ∞ë„Å´„ÄÅÂ§úÈñì„ÅÆÂ§ñÂá∫„ÇíÊéß„Åà„Çã„Çà„ÅÜÂëº„Å≥„Åã„Åë„Å¶„ÅÑ„Åæ„Åô„ÄÇ", horror: true },
            { title: "Â•áÂ¶ô„Å™Ë¶≥Ê∏¨", content: "Êò®Â§ú„ÄÅÁî∫„ÅÆÂ§©ÊñáÂè∞„Åå<span class='news-horror'>Á©∫„Å´‰∏çË¶èÂâá„Å™Âãï„Åç„Çí„Åô„ÇãË¨é„ÅÆÂÖâ</span>„ÇíË¶≥Ê∏¨„Åó„Åæ„Åó„Åü„ÄÇÂ∞ÇÈñÄÂÆ∂„ÇÇÈ¶ñ„ÇíÂÇæ„Åí„Å¶„Åä„Çä„ÄÅÊ≠£‰Ωì„ÅØ‰∏çÊòé„ÅÆ„Åæ„Åæ„Åß„Åô„ÄÇ", horror: true },
            { title: "ÈÉΩÂ∏Ç‰ºùË™¨‚Ä¶Ôºü", content: "‰∏ãÊ∞¥ÈÅì„Åã„Çâ<span class='news-horror'>Ëµ§„ÇìÂùä„ÅÆ„Çà„ÅÜ„Å™Ê≥£„ÅçÂ£∞„ÅåËÅû„Åì„Åà„Çã</span>„Å®„ÅÑ„ÅÜÈÄöÂ†±„ÅåÁõ∏Ê¨°„ÅÑ„Åß„ÅÑ„Åæ„Åô„ÄÇÂ∏Ç„ÅØË™øÊüª„ÇíË°å„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ‰ªä„ÅÆ„Å®„Åì„Çç‰Ωï„ÇÇÁô∫Ë¶ã„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ", horror: true }
        ];

        // --- DOM Elements ---
        const dom = {};
        const elementIds = [
            'score', 'timer', 'timer-display', 'order-text', 'order-ingredients', 'ingredient-shelf', 'shaker-area', 'shaker-contents', 'shaker-ice-cubes', 'final-cocktail', 
            'result-text', 'customer', 'customer-name', 'shake-button', 'reset-button', 'start-button', 'game-overlay', 'score-display', 'customer-dialogue', 'order-bubble', 
            'add-ice-button', 'hint-button', 'bgm-audio', 'combo-display', 'happy-hour-banner', 'recipe-hint', 'garnish-container', 'event-text', 'game-container', 'room-container',
            'room-day-display', 'room-money-display',
            'bed-object', 'tv-object', 'laundry-object', 'game-console-object', 'desk-object',
            'modal-container', 'modal-content', 'modal-title', 'modal-body', 'modal-close-button'
        ];
        elementIds.forEach(id => {
            const camelCaseId = id.replace(/-(\w)/g, (_, c) => c.toUpperCase());
            dom[`${camelCaseId}El`] = document.getElementById(id) || document.createElement('div'); // Create dummy for game-container content
        });
        
        // --- Game State ---
        let state = { score: 0, timeLeft: 60, timerInterval: null, currentOrder: null, currentCustomer: null, shakerContents: [], shakerHasIce: false, isGameRunning: false, canInteract: true, isDeathCustomerActive: false, isMillionaireActive: false, isCriticActive: false, combo: 0, isHappyHour: false, happyHourTimeout: null, garnishTimeout: null, day: 1, totalMoney: 0, upgrades: UPGRADES };
        
        // --- Sound Engine (placeholder) ---
        let sounds = {};
        let isAudioReady = false;
        function setupSounds() { /* ... same as before ... */ }
        async function startAudio() { /* ... same as before ... */ }
        function stopAudio() { /* ... same as before ... */ }
        function playSound(sound, ...args) { /* ... same as before ... */ }
        
        // --- Game & Room Logic ---
        function showView(view) {
            dom.gameContainerEl.classList.add('hidden');
            dom.roomContainerEl.classList.add('hidden');
            if (view === 'game') {
                dom.gameContainerEl.classList.remove('hidden');
                dom.gameContainerEl.classList.add('flex');
            } else if (view === 'room') {
                dom.roomContainerEl.classList.remove('hidden');
                dom.roomContainerEl.classList.add('flex');
            }
        }
        
        function startDay() {
             if (dom.gameContainerEl.innerHTML === '') {
                // First time setup, populate the game container
                populateGameContainer();
                // Re-bind DOM elements inside game container
                const gameElementIds = ['day-display', 'money-display', 'score', 'timer', 'order-text', 'order-ingredients', 'ingredient-shelf', 'shaker-area', 'shaker-contents', 'shaker-ice-cubes', 'final-cocktail', 'result-text', 'customer', 'customer-name', 'shake-button', 'reset-button', 'add-ice-button', 'hint-button', 'combo-display', 'happy-hour-banner', 'recipe-hint', 'garnish-container', 'event-text', 'score-display', 'customer-dialogue', 'order-bubble'];
                gameElementIds.forEach(id => {
                    const camelCaseId = id.replace(/-(\w)/g, (_, c) => c.toUpperCase());
                    dom[`${camelCaseId}El`] = document.getElementById(id);
                });
                bindGameButtons();
            }
            if (dom.ingredientShelfEl.childElementCount === 0) populateShelf();

            Object.assign(state, { score: 0, timeLeft: 60, isGameRunning: true, canInteract: false, currentCustomer: null, combo: 0, isHappyHour: false });
            updateScore(); resetShaker(); updateComboDisplay();
            dom.gameOverlayEl.style.opacity = '0'; dom.gameOverlayEl.style.pointerEvents = 'none';
            showView('game');
            updateUIDisplays();
            generateOrder();
            state.timerInterval = setInterval(updateTimer, 1000);
            scheduleHappyHour();
            startAudio();
        }
        
        function endDay() { 
            state.isGameRunning = false; 
            clearInterval(state.timerInterval); 
            clearTimeout(state.happyHourTimeout); 
            clearTimeout(state.garnishTimeout); 
            stopAudio(); 
            
            state.totalMoney += state.score;
            
            dom.timerDisplayEl.classList.remove('timer-danger'); 
            showView('room');
            updateRoomUI();
        }

        function updateRoomUI() {
            dom.roomDayDisplayEl.textContent = state.day;
            dom.roomMoneyDisplayEl.textContent = state.totalMoney.toLocaleString();
        }
        
        function startNextDay() {
            state.day++;
            startDay();
        }

        function showModal(title, contentHTML) {
            dom.modalTitleEl.textContent = title;
            dom.modalBodyEl.innerHTML = contentHTML;
            dom.modalContainerEl.classList.remove('hidden');
            dom.modalContainerEl.classList.add('flex');
        }

        function hideModal() {
            dom.modalContainerEl.classList.add('hidden');
            dom.modalContainerEl.classList.remove('flex');
        }

        function showNews() {
            const story = NEWS_STORIES[Math.floor(Math.random() * NEWS_STORIES.length)];
            const title = `‰ªäÊó•„ÅÆ„Éã„É•„Éº„Çπ: ${story.title}`;
            showModal(title, `<p>${story.content}</p>`);
        }

        function playMiniGame() {
            const outcomes = [
                "„É¨„Éà„É≠„Å™„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç≤„Éº„É†„Åß„Éè„Ç§„Çπ„Ç≥„Ç¢„ÇíÂè©„ÅçÂá∫„Åó„ÅüÔºÅÊ∞óÂàÜÁàΩÂø´„Å†„ÄÇ",
                "„Éë„Ç∫„É´„Ç≤„Éº„É†„Å´ÊåëÊà¶„Åó„Åü„Åå„ÄÅÊúÄÂæå„ÅÆÔºë„Éî„Éº„Çπ„ÅåË¶ã„Å§„Åã„Çâ„ÅöÊÇî„Åó„ÅÑÊÄù„ÅÑ„Çí„Åó„Åü‚Ä¶",
                "‰ºùË™¨„ÅÆÂâ£„ÇíÊ±Ç„ÇÅÂÜíÈô∫„Å´Âá∫„Åü„Åå„ÄÅÊúÄÂàù„ÅÆ„Çπ„É©„Ç§„É†„Å´Ë≤†„Åë„Å¶„Åó„Åæ„Å£„Åü„ÄÇ‰ªäÊó•„ÅØÈÅã„Åå„Å™„ÅÑ„Çà„ÅÜ„Å†„ÄÇ"
            ];
            const outcome = outcomes[Math.floor(Math.random() * outcomes.length)];
            showModal("„Ç≤„Éº„É†„Çø„Ç§„É†", `<p class="font-dot text-2xl">${outcome}</p>`);
        }

        function doLaundry() {
             showModal("Ê¥óÊøØ", "<p>Ê¥óÊøØÊ©ü„ÇíÂõû„Åó„Å¶„ÄÅÊúç„ÅåÁ∂∫È∫ó„Å´„Å™„Å£„Åü„ÄÇÊ∞óÂàÜ„ÇÇÂ∞ë„Åó„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åï„Çå„Åü„ÄÇ</p>");
        }
        
        function showUpgrades() {
            let contentHTML = '<div class="space-y-3">';
            for(const key in state.upgrades) {
                const upgrade = state.upgrades[key];
                const disabled = upgrade.purchased || state.totalMoney < upgrade.cost;
                const buttonText = upgrade.purchased ? 'Ë≥ºÂÖ•Ê∏à' : `¬•${upgrade.cost.toLocaleString()}`;
                contentHTML += `
                    <div class="flex items-center justify-between bg-gray-700/50 p-3 rounded-lg">
                        <div>
                            <h4 class="font-bold font-jp text-lg">${upgrade.name}</h4>
                            <p class="text-sm text-gray-300 font-jp">${upgrade.description}</p>
                        </div>
                        <button onclick="buyUpgrade('${key}')" class="upgrade-button bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg font-jp transition-colors" ${disabled ? 'disabled' : ''}>
                            ${buttonText}
                        </button>
                    </div>
                `;
            }
            contentHTML += '</div>';
            showModal("„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ", contentHTML);
        }

        window.buyUpgrade = function(key) { // Make it globally accessible for inline onclick
            const upgrade = state.upgrades[key];
            if (!upgrade.purchased && state.totalMoney >= upgrade.cost) {
                state.totalMoney -= upgrade.cost;
                upgrade.purchased = true;
                // playSound('cash');
                updateRoomUI();
                showUpgrades(); // Refresh the modal
            }
        }

        // --- All other game logic functions (checkRecipe, addIngredient, etc.) remain the same ---
        // --- They are omitted here for brevity but should be copied from the previous version ---

        function initializeGame() {
            setupSounds();
            dom.startButtonEl.addEventListener('click', () => { 
                startAudio();
                startDay();
            });
            
            // Room object interactions
            dom.bedObjectEl.addEventListener('click', startNextDay);
            dom.tvObjectEl.addEventListener('click', showNews);
            dom.gameConsoleObjectEl.addEventListener('click', playMiniGame);
            dom.laundryObjectEl.addEventListener('click', doLaundry);
            dom.deskObjectEl.addEventListener('click', showUpgrades);

            // Modal close
            dom.modalCloseButtonEl.addEventListener('click', hideModal);
            dom.modalContainerEl.addEventListener('click', (e) => {
                if (e.target === dom.modalContainerEl) {
                    hideModal();
                }
            });
        }
        
        // Helper to populate game container on first start
        function populateGameContainer() {
            dom.gameContainerEl.innerHTML = `
                <header class="grid grid-cols-3 items-center mb-4 px-2 relative">
                    <div class="flex flex-col text-left">
                        <h2 class="text-lg font-bold">Day: <span id="day-display">1</span></h2>
                        <h2 class="text-lg font-bold">ÊâÄÊåÅÈáë: ¬•<span id="money-display">0</span></h2>
                    </div>
                    <div id="combo-display" class="absolute left-1/2 -translate-x-1/2 top-0 text-3xl font-bold text-orange-400 opacity-0 transform scale-50"></div>
                    <div class="flex items-center gap-2 md:gap-4 justify-end">
                        <button id="hint-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-lg shadow-md text-sm font-jp transition-transform transform hover:scale-105">„É¨„Ç∑„Éî</button>
                        <div id="timer-display" class="bg-red-600 rounded-full px-4 py-2 transition-all duration-300">
                            <h2 class="text-xl md:text-2xl font-bold">ÊôÇÈñì: <span id="timer">60</span></h2>
                        </div>
                    </div>
                    <div id="score-display" class="col-span-3 text-center">
                        <h2 class="text-xl md:text-2xl font-bold">Êú¨Êó•„ÅÆÂ£≤‰∏ä: ¬•<span id="score">0</span></h2>
                    </div>
                </header>
                <main class="flex-grow flex flex-col relative">
                    <div id="happy-hour-banner" class="absolute -top-4 w-full text-center text-4xl font-bold text-yellow-300 font-jp hidden z-10">HAPPY HOUR!</div>
                    <div id="customer-area" class="h-1/4 flex flex-col items-center justify-end mb-4 relative">
                        <div id="customer-dialogue" class="font-jp"></div>
                        <div id="customer" class="text-6xl mb-2 opacity-0 transform -translate-x-12">üßë‚Äçüíº</div>
                        <div id="order-bubble" class="bg-gray-200 p-3 rounded-lg shadow-lg text-gray-800 flex flex-col items-center gap-2 opacity-0 transition-opacity duration-300">
                            <div id="customer-name" class="font-bold font-jp text-sm text-gray-600"></div>
                            <div class="flex items-center gap-2">
                                <p class="font-bold font-jp">Ê≥®Êñá:</p> <div id="order-text" class="font-bold text-lg font-jp"></div> <div id="order-ingredients" class="flex gap-2"></div>
                            </div>
                        </div>
                    </div>
                    <div id="bar-counter" class="p-4 flex-grow flex items-center justify-between gap-4 rounded-lg">
                        <div class="w-1/3 flex flex-col items-center justify-around h-full">
                            <div id="shaker-area" class="w-24 h-40 bg-gray-400 rounded-t-lg border-4 border-gray-300 relative flex items-end overflow-hidden shadow-inner">
                                <div id="shaker-ice-cubes" class="absolute inset-0"></div>
                                <div id="shaker-contents" class="w-full h-full transition-all duration-300"></div>
                            </div>
                            <div class="flex flex-col gap-2 w-full mt-4">
                                <button id="add-ice-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 font-jp">Ê∞∑„ÇíÂÖ•„Çå„Çã</button>
                                <button id="shake-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 font-jp">„Ç∑„Çß„Ç§„ÇØÔºÅ</button>
                                <button id="reset-button" class="bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 font-jp">„É™„Çª„ÉÉ„Éà</button>
                            </div>
                        </div>
                        <div class="w-2/3 flex flex-col items-center justify-center">
                            <div id="cocktail-glass" class="w-32 h-40 relative">
                                <svg viewBox="0 0 100 120" class="w-full h-full filter drop-shadow-lg"><path d="M 10 120 L 40 50 L 60 50 L 90 120 Z" fill="rgba(255,255,255,0.1)"/><path d="M 0 40 L 100 40 L 95 50 L 5 50 Z" fill="rgba(255,255,255,0.1)"/><path d="M 45 40 L 55 0 L 55 40 Z" fill="rgba(255,255,255,0.1)"/></svg>
                                <div id="final-cocktail" class="absolute bottom-[2px] left-1/2 -translate-x-12 w-[78%] h-0 bg-transparent rounded-sm"></div>
                            </div>
                            <div id="result-text" class="text-2xl font-bold mt-2 h-8 font-jp"></div>
                        </div>
                    </div>
                </main>
                <footer id="ingredient-shelf" class="grid grid-cols-5 md:grid-cols-9 gap-2 mt-4 p-4 bg-black/30 rounded-lg"></footer>
                <div id="recipe-hint" class="absolute top-1/2 left-1/2 bg-black/80 p-6 rounded-lg text-white text-2xl font-jp shadow-lg z-40 flex-col items-center gap-2"></div>
                <div id="garnish-container" class="absolute top-1/2 left-1/2 bg-black/80 p-6 rounded-lg text-white font-jp shadow-lg z-40 flex flex-col items-center gap-4"></div>
                <div id="event-text" class="absolute top-1/2 left-1/2 bg-black/80 p-6 rounded-lg text-4xl text-cyan-400 font-bold font-jp shadow-lg z-40"></div>
            `;
        }
        function bindGameButtons() {
             dom.shakeButtonEl.addEventListener('click', shake);
             dom.resetButtonEl.addEventListener('click', () => { if (state.canInteract) resetShaker(); });
             dom.addIceButtonEl.addEventListener('click', () => { if(state.canInteract) addIce(); });
             dom.hintButtonEl.addEventListener('click', showRecipeHint);
        }

        // --- All the game logic functions ---
        // These functions (updateTimer, generateOrder, checkRecipe, etc.) are complex and long.
        // For this example, assume they are pasted here from the previous version.
        // The only change is how points are displayed (e.g., `+¬•${points}`).
        // A placeholder comment will represent this section.

        // [PASTE ALL GAME LOGIC FUNCTIONS FROM PREVIOUS VERSION HERE]
        // Example of a function that would be here:
        function updateTimer() { if (!state.isHappyHour) { state.timeLeft -= state.isDeathCustomerActive ? 2 : 1; } if (state.timeLeft < 0) state.timeLeft = 0; if(dom.timerEl) dom.timerEl.textContent = state.timeLeft; if (state.timeLeft <= 0) endDay(); }
        function populateShelf() { if(!dom.ingredientShelfEl) return; dom.ingredientShelfEl.innerHTML = ''; for (const key in INGREDIENTS) { const bottle = document.createElement('div'); bottle.className = 'ingredient-bottle font-bold p-2 font-jp'; bottle.textContent = INGREDIENTS[key].name; bottle.style.backgroundColor = INGREDIENTS[key].color; bottle.style.color = getContrastingTextColor(INGREDIENTS[key].color); bottle.style.setProperty('--glow-color', INGREDIENTS[key].glow); bottle.dataset.ingredient = key; bottle.addEventListener('click', () => addIngredient(key, bottle)); dom.ingredientShelfEl.appendChild(bottle); } }
        function getContrastingTextColor(hex){ const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16); return((r*299)+(g*587)+(b*114))/1000>=128?'#111':'#fff'; }
        function addIngredient(key, element) { if (!state.isGameRunning || !state.canInteract || state.shakerContents.length >= 5) return; state.shakerContents.push(key); updateShakerVisual(); element.classList.add('selected'); setTimeout(() => element.classList.remove('selected'), 500); /* playSound('pour', 'C3', '8n'); */ }
        function shake() { if (!state.isGameRunning || !state.canInteract || (state.shakerContents.length === 0 && !state.shakerHasIce)) return; state.canInteract = false; dom.customerDialogueEl.classList.remove('show'); dom.shakerAreaEl.classList.add('shake-animation'); for(let i=0; i<5; i++) setTimeout(()=>playSound('shake', '8n'), i*80); setTimeout(() => { dom.shakerAreaEl.classList.remove('shake-animation'); checkRecipe(); }, 500); }
        function resetShaker() { state.shakerContents = []; state.shakerHasIce = false; updateShakerVisual(); if(dom.finalCocktailEl) {dom.finalCocktailEl.classList.remove('animate-fill'); dom.finalCocktailEl.style.height = '0%'; dom.resultTextEl.textContent = '';} }
        function updateShakerVisual() { if(!dom.shakerContentsEl) return; const liquidHeight = (state.shakerContents.length / 5) * 100; const mixedColor = state.shakerContents.length > 0 ? '#' + state.shakerContents.reduce((avg, key) => { let c = INGREDIENTS[key].color.substring(1); avg[0] += parseInt(c.substring(0,2), 16); avg[1] += parseInt(c.substring(2,4), 16); avg[2] += parseInt(c.substring(4,6), 16); return avg; }, [0, 0, 0]).map(c => Math.round(c / state.shakerContents.length).toString(16).padStart(2, '0')).join('') : 'transparent'; dom.shakerContentsEl.style.background = `linear-gradient(to top, ${mixedColor} 0%, ${mixedColor} ${liquidHeight}%, transparent ${liquidHeight}%)`; dom.shakerIceCubesEl.innerHTML = ''; if (state.shakerHasIce) { for (let i = 0; i < 5; i++) { const ice = document.createElement('div'); ice.className = 'ice-cube'; ice.style.cssText = `width:${Math.random()*10+15}px; height:${Math.random()*10+15}px; left:${Math.random()*70}%; bottom:${Math.random()*(liquidHeight>20?liquidHeight-20:0)}%; transform:rotate(${Math.random()*90}deg);`; dom.shakerIceCubesEl.appendChild(ice); } } }
        function showFloatingText(text, color, element) { if(!element) return; const el = document.createElement('div'); el.className = 'floating-text'; el.textContent = text; el.style.color = color; element.appendChild(el); setTimeout(() => el.remove(), 1500); }
        function showDialogue(lines) { if(dom.customerDialogueEl){ dom.customerDialogueEl.textContent = lines[Math.floor(Math.random() * lines.length)]; dom.customerDialogueEl.classList.add('show');} }
        function updateScore() { if (state.score < 0) state.score = 0; if(dom.scoreEl) dom.scoreEl.textContent = state.score.toLocaleString(); }
        function updateUIDisplays() { if(dom.dayDisplayEl) dom.dayDisplayEl.textContent = state.day; if(dom.moneyDisplayEl) dom.moneyDisplayEl.textContent = state.totalMoney.toLocaleString();}
        function updateComboDisplay() { if(!dom.comboDisplayEl) return; if(state.combo > 1) { dom.comboDisplayEl.textContent = `${state.combo} COMBO!`; dom.comboDisplayEl.style.opacity = '1'; dom.comboDisplayEl.style.transform = 'translateX(-50%) scale(1)'; } else { dom.comboDisplayEl.style.opacity = '0'; dom.comboDisplayEl.style.transform = 'translateX(-50%) scale(0.5)'; } }
        function scheduleHappyHour() { const delay = Math.random() * 20000 + 15000; state.happyHourTimeout = setTimeout(startHappyHour, delay); }
        function startHappyHour() { if(!state.isGameRunning || !dom.happyHourBannerEl) return; state.isHappyHour = true; dom.happyHourBannerEl.classList.remove('hidden'); playSound('happyHour'); state.happyHourTimeout = setTimeout(endHappyHour, 10000); }
        function endHappyHour() { if(!state.isGameRunning || !dom.happyHourBannerEl) return; state.isHappyHour = false; dom.happyHourBannerEl.classList.add('hidden'); scheduleHappyHour(); }
        function showRecipeHint() { if (!state.isGameRunning || state.isCriticActive || !state.currentOrder || !dom.recipeHintEl) return; const recipeItems = state.currentOrder.ingredients.map(key => INGREDIENTS[key].name); if (state.currentOrder.needsIce) recipeItems.push("Ê∞∑"); dom.recipeHintEl.innerHTML = `<h3 class="text-lg font-bold mb-2 border-b border-purple-400">„É¨„Ç∑„Éî</h3><p>${recipeItems.join('„ÄÅ')}</p>`; dom.recipeHintEl.classList.add('show'); setTimeout(() => { dom.recipeHintEl.classList.remove('show'); }, 2500); }
        function generateOrder() { /* Assume this is also here */ }
        function checkRecipe() { /* Assume this is also here */ }

        initializeGame();
    });
    </script>
</body>
</html>








